# DiffSoundReconstruction

## Repository structure

- `data/`: contains the data used in the experiments.
- `README.md`: this file.
- `environment.yml`: contains the conda environment used in the project.
- `audiodiffusion/`
- `features_decoding/` scripts from repo:KamitaniLab/SoundReconstruction.
- `scripts/` scripts from repo:teticio/audio-diffusion.

### Detailed Structure

You can find the detailed structure of the repository in the file `tree.txt` which is generated by the command `tree >> tree.txt`.

## Train the model

```zsh
export PYTHONPATH=$PYTHONPATH:$(pwd) 
accelerate launch \
    --config_file config/accelerate_local.yaml \
    scripts/train_unet.py \
    --dataset_name data/vgg_slided_train_mel \
    --output_dir models/ddpm-ema-audio-256 \
    --train_batch_size 16 \
    --num_epochs 100 \
    --gradient_accumulation_steps 1 \
    --learning_rate 1e-4 \
    --lr_warmup_steps 500 \
    --mixed_precision no \
    --vae models/autoencoder-kl \
    --feat_dir data/features/conv5_3_train \
    --test_dir data/features/conv5_3_test
```

## Command for Train `AudioDiffusion`

```zsh
accelerate launch --config_file config/accelerate_local.yaml \
    scripts/train_unet.py \
    --dataset_name teticio/audio-diffusion-256 \
    --output_dir models/audio-diffusion-256 \
    --num_epochs 100 \
    --train_batch_size 2 \
    --eval_batch_size 2 \
    --gradient_accumulation_steps 8 \
    --learning_rate 1e-4 \
    --lr_warmup_steps 500 
```

## Commnad for Train VAE
```
python scripts/train_vae.py \
    --dataset_name data/FSD50K/FSD50K_split_mel \ 
    --batch_size 4 \ 
    --gradient_accumulation_steps 12 \ 
    --sample_rate 44100

nohup python scripts/train_vae.py \
    --dataset_name data/FSD50K/FSD50K_split_mel_441_22k \
    --batch_size 4 \
    --gradient_accumulation_steps 12 \
    --hop_length 441 \
    --sample_rate 22050 > train_vae.log 2>&1 &

```

## Command for spec generation
```
python scripts/spec_generation_lxx.py \ 
    --input_dir data/FSD50K/FSD50K_split \ 
    --output_dir data/FSD50K/FSD50K_split_mel_441 \ 
    --sample_rate 22050 \ 
    --hop_length 441
```
